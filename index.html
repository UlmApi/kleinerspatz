<html>
<head>
   <title>Übersicht der Kindertagesstätten und freier Plätze in Ulm</title>

	<meta charset="utf-8">   
   <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		
   <style type="text/css">

		.fancybox-custom .fancybox-skin {
			box-shadow: 0 0 50px #222;
		}

   html, body, #map, h4, ul {
      height:100%;
      width:100%;
      padding:0px;
      margin:0px;
   } 
   
   h4{
   	margin: 6px 0px;
   }
   
   a {
   color: #FEFEFE;
   text-decoration:none;
   font-style:italic;   
   }

	
	#dialog a{
   font-style:normal;   
   font-weight: 600;
	color: #333333;
	font-family: sans;
	} 

	#title{
	background:#333333;
	position: fixed;
	top:10px;
	right:30px;
	z-index:100;
	color: #FEFEFE;
	font-family: sans;
	border: 1px solid #333;
	margin:4px;
	padding:4px;
	filter: alpha(opacity=80);
	-moz-opacity:0.8;
	-khtml-opacity: 0.8;
	opacity: 0.8;

	border-radius: 4px;
	-o-border-radius: 4px;
	-moz-border-radius: 4px;
	-webkit-border-radius: 4px;
	}   

	#dialog{
	width:400px;
	display:none;
	font-family: sans;
	}   

   
	#legend{
	background:#333333;
	position: fixed;
	bottom:30px;
	right:30px;
	z-index:100;
	color: #EEEEEE;
	font-family: sans;
	border: 1px solid #EEEEEE;
	margin:6px;
	padding:6px;
	filter: alpha(opacity=80);
	-moz-opacity:0.8;
	-khtml-opacity: 0.8;
	opacity: 0.8;

	border-radius: 6px;
	-o-border-radius: 6px;
	-moz-border-radius: 6px;
	-webkit-border-radius: 6px;
	}   

	.logos {
		position:absolute;
		bottom:10px;
		left:10px;
		z-index:99;
	}

	.logos img, #dialogdiv img {
		border:1px solid #000;
	}

	.logos img:hover, #dialog div img {
		border:1px solid #0084b0;
	}

   </style>
   
 <!-- leafletJS -->
 <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
 <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>

 <!-- jQuery -->
 <script src="http://code.jquery.com/jquery-2.1.0.js" type="text/javascript"></script>

 <!-- fancybox -->
 <link rel="stylesheet" href="./fancybox/jquery.fancybox.css" type="text/css" media="screen" />
 <script type="text/javascript" src="./fancybox/jquery.fancybox.pack.js"></script>


   <script language="javascript">


      function init() {
         var map = new L.Map('map');                       
              
      	 L.tileLayer('http://{s}.tile.cloudmade.com/3a83164a47874169be4cabc2e8b8c449/33481/256/{z}/{x}/{y}.png', {
            attribution: '<a href="http://ulmapi.de">UlmApi.de</a>, Stadt Ulm, Map data &copy; 2014 OpenStreetMap contributors, Imagery &copy; 2014 CloudMade',
            maxZoom: 18
         }).addTo(map);
         map.attributionControl.setPrefix(''); // Don't show the 'Powered by Leaflet' text.

         //buildCtrls().addTo(map);

         var ulm = new L.LatLng(48.40, 9.98); 
         map.setView(ulm, 13);


function iconInstance(name){
	return L.icon({
		iconUrl: "img/nurs_"+ name + ".png",
		shadowUrl: null,
		
		iconSize: [25,25],
		shadowSize: [0,0],
		iconAnchor: [12,25],
		shadowAnchor: [0,0],
		popupAnchor:[0,-26]
	});
}
		
		// Get JSON for Kitas real
         $.getJSON("kita_final.json", function(json) {
			console.log(json); // this will show the info it in firebug console
			data = eval( json );
			console.log(data);
			for (var i=0; i<data.length; i++) {
				if(i==1){console.log(data[i]);}
				iconname = "";
				if(data[i]['over3'] == null){
						iconname+="gray";
				}else switch(data[i]['over3']){
					case "true":
						iconname+="green";
						break;
					case "false":
						iconname+="red";
						break;
				}
				if(data[i]['under3'] == null){
						iconname+="gray";
				}else switch(data[i]['under3']){
					case "true":
						iconname+="green";
						break;
					case "false":
						iconname+="red";
						break;
					case null:
						iconname+="gray";
						break;
				}
				icon = iconInstance(iconname);

				if(data[i]['wgs84-north'] && data[i]['wgs84-east']){ //filter non-plotable data
					var marker = L.marker([data[i]['wgs84-north'],data[i]['wgs84-east']], {'icon':icon}).addTo(map);
					popup = "Kindertageseinrichtung<br><b>" + data[i]['name'] +  "</b><br>";
					popup += "<br><a target='_blank' href='http://suche.kita.ulm.de/homepage/einrichtung.php?id="+ data[i]['id'] +"'>Weitere Informationen</a>";
					popup += "<br><a target='_blank' href='http://suche.kita.ulm.de/homepage/kontakt.php?Wunscheinrichtung1="+ data[i]['id'] +"'>Kontaktformular</a>";
					marker.bindPopup(popup);
				}
			}
			
		});

      }
   </script>

<script type="text/javascript">
	$(document).ready(function() {
		$(".fancybox").fancybox();
	});
</script>
  
</head>
<body onLoad="javascript:init();">


   <div id="dialog">
   <h4>&Uuml;ber dieses Projekt</h4>
<p>Auf diese Karte werden die verfügbaren KITA-Pl&auml;tze in der Stadt Ulm angezeigt. Die Daten kommen von der <a href="http://www.ulm.de/ulm/stadt_ulm_01.c.72078.de/">Übersichtsseite der Stadt Ulm</a> und wurden zuletzt am 2014-03-02 00:17:01 von dort geholt.</p>

<p>Dieses Projekt ist von der <a href="http://www.ulmapi.de">datalove-Gruppe / UlmAPI</a> im Rahmen des <a href="http://opendataday.org/">OpenDataDay 2014</a> entwickelt worden. Der Quelltext der Seite, sowie die Daten und Skripte, um die Daten zu aktualisieren, befinden sich auf <a href="https://github.com/UlmApi/kleinerspatz">github</a>.</p>
   </div>


   <div id="legend">
	<h4>Kleiner Spatz</h4>
		<a href='#dialog' class='fancybox'>Mehr Informationen…</a>
   <h4>Legende</h4>
   <ul style="list-style: none;padding:0; margin:0;">
   	<li><img src="img/nurs_graygray.png" height="20"> unbekannt</li>   	

   	<li><img src="img/nurs_greengray.png" height="20"> freie Plätze unter 3 Jahre</li>   	
   	<li><img src="img/nurs_redgray.png" height="20"> keine Plätze unter 3 Jahre</li>   	

   	<li><img src="img/nurs_graygreen.png" height="20"> freie Plätze über 3 Jahre</li>   	
   	<li><img src="img/nurs_grayred.png" height="20"> keine Plätze über 3 Jahre</li>  	

   </ul>
   		
   </div>
   
   <div class="logos">
      <a href="http://www.ulmapi.de"><img src="img/ulmapi.png" alt="ulmapi" title="Ein Projekt von datalove ulm / ulmAPI.de"></a>
   </div>

   <div id="map"></div>

   <div id="debug"></div>


</body>                                                                                                                          
</html>
    
